var os=require("os"),path=require("path"),loadGruntTasks=require("load-grunt-tasks");module.exports=function(a){"use strict";loadGruntTasks(a);var b=a.file.readJSON("package.json"),c=os.tmpdir?os.tmpdir():os.tmpDir(),d=path.join(c,"zcflash"),e=7320,f={jshint:{options:{jshintrc:!0},gruntfile:["Gruntfile.js"],js:["src/js/**/*.js","!src/js/start.js","!src/js/end.js"],test:["test/**/*.js"],dist:["dist/*.js","!dist/*.min.js"]},flexpmd:{flash:{src:[d]}},clean:{jsDist:["ZeroClipboard.*","dist/ZeroClipboard.*","!ZeroClipboard.swf","!dist/ZeroClipboard.swf"],flashDist:["ZeroClipboard.swf","dist/ZeroClipboard.swf"],flashTemp:{options:{force:!0},src:[d]},meta:["bower.json","component.json","composer.json","LICENSE"],coveralls:["tmp/","coverage/"]},concat:{options:{stripBanners:!1,process:{data:b}},core:{src:["src/meta/source-banner.tmpl","src/js/start.js","src/js/shared/state.js","src/js/shared/private.js","src/js/core/state.js","src/js/core/private.js","src/js/core/api.js","src/js/end.js"],dest:"dist/ZeroClipboard.Core.js"},client:{src:["src/meta/source-banner.tmpl","src/js/start.js","src/js/shared/state.js","src/js/shared/private.js","src/js/core/state.js","src/js/core/private.js","src/js/core/api.js","src/js/client/state.js","src/js/client/private.js","src/js/client/api.js","src/js/end.js"],dest:"dist/ZeroClipboard.js"},flash:{files:[{src:["src/meta/source-banner.tmpl","src/flash/ZeroClipboard.as"],dest:path.join(d,"ZeroClipboard.as")},{src:["src/meta/source-banner.tmpl","src/flash/ClipboardInjector.as"],dest:path.join(d,"ClipboardInjector.as")},{src:["src/meta/source-banner.tmpl","src/flash/JsProxy.as"],dest:path.join(d,"JsProxy.as")},{src:["src/meta/source-banner.tmpl","src/flash/XssUtils.as"],dest:path.join(d,"XssUtils.as")}]}},uglify:{options:{report:"min"},js:{options:{preserveComments:function(a,b){return b&&"comment2"===b.type&&/^(!|\*|\*!)\r?\n/.test(b.value)},beautify:{beautify:!0,indent_level:2},mangle:!1,compress:!1},files:[{src:["<%= concat.core.dest %>"],dest:"<%= concat.core.dest %>"},{src:["<%= concat.client.dest %>"],dest:"<%= concat.client.dest %>"}]},minjs:{options:{preserveComments:function(a,b){return b&&"comment2"===b.type&&/^(!|\*!)\r?\n/.test(b.value)},sourceMap:!0,sourceMapName:function(a){return a.replace(".min.js",".min.map")},sourceMapIncludeSources:!0},files:[{src:["<%= concat.core.dest %>"],dest:"dist/ZeroClipboard.Core.min.js"},{src:["<%= concat.client.dest %>"],dest:"dist/ZeroClipboard.min.js"}]}},mxmlc:{options:{rawConfig:"-target-player=11.0.0 -static-link-runtime-shared-libraries=true -actionscript-file-encoding=UTF-8"},swf:{files:{"dist/ZeroClipboard.swf":["<%= concat.flash.files[0].dest %>"]}}},template:{options:{data:b},bower:{files:{"bower.json":["src/meta/bower.json.tmpl"]}},component:{files:{"component.json":["src/meta/component.json.tmpl"]}},composer:{files:{"composer.json":["src/meta/composer.json.tmpl"]}},LICENSE:{files:{LICENSE:["src/meta/LICENSE.tmpl"]}}},"json-format":{options:{indent:2},meta:{files:[{expand:!0,cwd:"./",src:["./*.json"],dest:"./"}]}},chmod:{options:{mode:"444"},dist:["dist/ZeroClipboard.*"],meta:["bower.json","component.json","composer.json","LICENSE"]},connect:{server:{options:{port:e}}},qunit:{file:["test/shared/private.tests.js.html","test/core/private.tests.js.html","test/core/api.tests.js.html","test/client/private.tests.js.html","test/client/api.tests.js.html","test/built/ZeroClipboard.Core.tests.js.html","test/built/ZeroClipboard.tests.js.html"],http:{options:{urls:a.file.expand(["test/shared/private.tests.js.html","test/core/private.tests.js.html","test/core/api.tests.js.html","test/client/private.tests.js.html","test/client/api.tests.js.html","test/built/ZeroClipboard.Core.tests.js.html","test/built/ZeroClipboard.tests.js.html"]).map(function(a){return"http://localhost:"+e+"/"+a+"?noglobals=true"})}},coveralls:{options:{"--web-security":!1,timeout:1e4,coverage:{baseUrl:".",src:["src/js/**/*.js","!src/js/start.js","!src/js/end.js","dist/*.js","!dist/*.min.js"],instrumentedFiles:"tmp",htmlReport:"coverage/html",lcovReport:"coverage/lcov",statementsThresholdPct:60,disposeCollector:!0},urls:a.file.expand(["test/shared/private.tests.js.html","test/core/private.tests.js.html","test/core/api.tests.js.html","test/client/private.tests.js.html","test/client/api.tests.js.html","test/built/ZeroClipboard.Core.tests.js.html","test/built/ZeroClipboard.tests.js.html"]).map(function(a){return"http://localhost:"+e+"/"+a+"?noglobals=true"})}}},coveralls:{options:{force:!0},all:{src:"<%= qunit.coveralls.options.coverage.lcovReport %>/lcov.info"}},watch:{options:{spawn:!1},gruntfile:{files:"<%= jshint.Gruntfile %>",tasks:["jshint:Gruntfile"]},js:{files:"<%= jshint.js %>",tasks:["jshint:js","unittest"]},test:{files:"<%= jshint.test %>",tasks:["jshint:test","unittest"]}}};a.initConfig(f),a.registerTask("jshint-prebuild",["jshint:gruntfile","jshint:js","jshint:test"]),a.registerTask("prep-flash",["clean:flashTemp","concat:flash"]),a.registerTask("validate",["jshint-prebuild","prep-flash","flexpmd"]),a.registerTask("build",["clean","concat","jshint:dist","uglify","mxmlc","template","json-format","chmod"]),a.registerTask("build-travis",["clean","concat","jshint:dist","mxmlc","chmod:dist"]),a.registerTask("test",["connect","qunit:file","qunit:http"]),a.registerTask("default",["validate","build","test"]),a.registerTask("travis",["validate","build-travis","test","qunit:coveralls","coveralls"]),a.registerTask("jsdev-build",["jshint-prebuild","clean:jsDist","concat:core","concat:client","jshint:dist","uglify:js"]),a.registerTask("jsdev",["jsdev-build","test"]),a.registerTask("swfdev",["prep-flash","flexpmd","clean:flashDist","mxmlc","chmod:dist"])};